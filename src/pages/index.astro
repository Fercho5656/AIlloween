---
import Layout from "../layouts/Layout.astro";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { CldUploadWidget } from "astro-cloudinary";
import { Pointer, Sparkles, Zap, Image } from "lucide-react";
import Dropzone from "@/components/ui/dropzone";
---

<Layout title="AIlloween">
	<section
		id="hero"
		class="w-full h-screen bg-black text-white py-12 md:py-24 lg:py-32 xl:py-64"
	>
		<div class="px-4 md:px-6">
			<div
				class="flex flex-col items-center justify-center space-y-4 text-center"
			>
				<div class="space-y-4">
					<h1
						class="text-7xl font-bold mb-12 tracking-tighter sm:text-4xl md:text-5xl lg:text-6xl/none"
					>
						Create Spooktacular Costumes with <span class="text-gradient"
							>AIlloween</span
						>
					</h1>
					<p class="mx-auto max-w-[700px] text-gray-300 md:text-2xl">
						Unleash your creativity with our AI-powered costume generator.
						Design unique, personalized Halloween costumes in seconds!
					</p>
				</div>
				<div class="pt-12 space-x-4">
					<Dropzone client:load />
				</div>
			</div>
		</div>
	</section>

	<section
		id="how-it-works"
		class="w-full h-screen bg-orange-100 text-black py-12 md:py-24 lg:py-32"
	>
		<div class="px-4 md:px-6">
			<h2
				class="text-3xl font-bold tracking-tighter sm:text-5xl text-center mb-12"
			>
				How it Works
			</h2>
			<div
				class="py-28 text-lg container mx-auto grid grid-cols-1 md:grid-cols-3 gap-8 md:gap-16"
			>
				<Card>
					<CardHeader>
						<Pointer className="w-12 h-12 text-orange-500 mb-4" size={48} />
						<CardTitle className="text-xl">Select Your Costume</CardTitle>
					</CardHeader>
					<CardContent>
						Let our AI know what kind of costume you want to try!
					</CardContent>
				</Card>

				<Card>
					<CardHeader>
						<Sparkles className="w-12 h-12 text-orange-500 mb-4" size="{48}" />
						<CardTitle className="text-xl">AI Magic</CardTitle>
					</CardHeader>
					<CardContent>
						Cloudinary advanced AI processes your selection and generates unique
						previews
					</CardContent>
				</Card>

				<Card>
					<CardHeader>
						<Zap className="w-12 h-12 text-orange-500 mb-4" size="{48}" />
						<CardTitle className="text-xl">Instant Results</CardTitle>
					</CardHeader>
					<CardContent>
						Get your custome design in seconds, ready to be shared
					</CardContent>
				</Card>

				<Card>
					<CardHeader>
						<Image className="w-12 h-12 text-orange-500 mb-4" size="{48}" />
						<CardTitle className="text-xl">Spooky Scary Background</CardTitle>
					</CardHeader>
					<CardContent>
						Replace the background with a spooky scary Halloween themed one
					</CardContent>
				</Card>
			</div>
		</div>
	</section>
</Layout>

<script>
	import { getCldImageUrl } from "astro-cloudinary/helpers";
	import type { CloudinaryUploadEvent } from "@/types/cloudinary/uploadEvent";
	import type { ImageOptions } from "@cloudinary-util/url-loader";

	const cldUploadWidget = document.querySelector("#cld-upload-widget");
	const mainImg = document.querySelector("#main-img") as HTMLImageElement;
	const costumeSelect = document.querySelector(
		"#costume-select",
	) as HTMLSelectElement;
	const btnGenerateCostume = document.querySelector(
		"#btn-generate-costume",
	) as HTMLButtonElement;
	const chkReplaceBg = document.querySelector(
		"#chk-replace-bg",
	) as HTMLInputElement;

	if (cldUploadWidget) {
		cldUploadWidget.addEventListener("clduploadwidget:success", ((
			e: CustomEvent<CloudinaryUploadEvent>,
		) => {
			const { detail } = e;
			console.log(detail);
			const url = detail.info.secure_url;
			mainImg.src = url;
			mainImg.alt = detail.info.original_filename;
			mainImg.dataset.publicId = detail.info.public_id;
			costumeSelect.disabled = false;
		}) as EventListener);
	}

	costumeSelect.addEventListener("change", () => {
		btnGenerateCostume.disabled = false;
		chkReplaceBg.disabled = false;
	});

	btnGenerateCostume.addEventListener("click", () => {
		const selectedCostume = costumeSelect.value;
		const imageId = mainImg.dataset.publicId ?? "";

		if (!selectedCostume || !imageId) {
			return;
		}

		const options: ImageOptions = {
			src: imageId,
			replace: {
				from: "wearings",
				to: `${selectedCostume} makeup and costume for Halloween`,
				preserveGeometry: true,
			},
		};

		if (chkReplaceBg.checked) {
			options.replaceBackground = {
				prompt: "spooky scary halloween background",
			};
		}

		const transformedUrl = getCldImageUrl(options);

		mainImg.src = transformedUrl;
	});
</script>

<style>
	main {
		color: white;
		font-size: 20px;
		line-height: 1.6;
	}
	.text-gradient {
		background-image: var(--accent-gradient);
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		background-size: 400%;
		background-position: 0%;
	}
</style>
